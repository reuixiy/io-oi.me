+++
title = "å·¥å‚æ¨¡å¼"
date = "2021-08-01T18:11:51+08:00"
tags = ["software"]
slug = "factory-method-pattern"
dropCap = false
+++

ä¸Šå‘¨æœ‰ä¸€ä¸ªä»»åŠ¡æ˜¯åœ¨ä¸€ä¸ªç»„ä»¶ä¸­å¢æ·»ä¸€ä¸ªé’±åŒ…çš„æ”¯æŒï¼Œè™½çœ‹æ‡‚ä»£ç çš„è¡¨å±‚é€»è¾‘ï¼Œå´æ‡µæ‡‚ä»£ç å¼•å…¥çš„å¤–å±‚é€»è¾‘ä»¥åŠæ¨¡å—æ¥å£åŠŸèƒ½ï¼Œäºæ˜¯ä¹Ÿä¸æ•¢èƒ¡ä¹±é‡æ„åŸä»£ç ï¼Œè€Œæ˜¯ç›´æ¥åœ¨æµç¨‹å¼€å§‹æ—¶å’Œäº‹ä»¶æ–¹æ³•å†…æ·»åŠ  `if` æ¥åˆ¤æ–­æ‰§è¡Œè‡ªå·±çš„æ–°å¢ä»£ç ï¼Œæ¨¡ä»¿åŸä»£ç çš„æ–¹æ³•å†™å‡ ä¸ªæ–°æ–¹æ³•ï¼Œæ¯”å¦‚ `check()` æ”¹ä¸º `checkA()` å’Œ `checkB()`ï¼Œå…·ä½“æ¥è¯´ï¼š

```js
methods: {
  checkA() {
    // do something
  }

  checkB() {
    // do something new
  }

  // ...

  submit() {
    if (this.payType === 'B') {
      this.checkoutB()
    } else {
      this.checkoutA()
    }
  }
},
created() {
  if (this.payType === 'B') {
    this.checkB()
  } else {
    this.checkA()
  }
}
```

å¾ˆæ˜æ˜¾ï¼Œä»£ç è™½ç„¶å·¥ä½œä½†æ˜¯ä¸å¤Ÿç®€æ´ï¼Œéœ€è¦åœ¨æ¯ä¸ªäº‹ä»¶ä¸­éƒ½æ·»åŠ ç›¸åŒçš„ `if`ï¼Œæœªæ¥å¦‚æœè¦æ‰©å±•æ–°çš„é’±åŒ…ï¼Œä¿®æ”¹å°±ä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œè€Œä¸”ä¼šå¯¼è‡´è¿™ä¸ªç»„ä»¶è¶Šæ¥è¶Šè‡ƒè‚¿ï¼Œè¿›è€Œè¶Šæ¥è¶Šéš¾ä»¥ç»´æŠ¤ã€‚å°½ç®¡å¦‚æ­¤ï¼Œæ—¶é—´ç´§è¿«åŠŸèƒ½è¦ç´§æ‰€ä»¥è¿˜æ˜¯ç¡¬ç€å¤´çš®æŠŠä¿®æ”¹æ¨äº†ä¸Šå»ï¼Œç„¶åè‡ªç„¶åœ°è¢«è¦æ±‚æŠ½å‡ºå•ç‹¬çš„æ¨¡å—ï¼Œå†™æˆä¸€ä¸ªç±»ã€‚

---

åªå¾—åŠªåŠ›æƒ³äº†æƒ³åº”è¯¥æ€ä¹ˆå»å®ç°ï¼Œå›æƒ³èµ·äº†ä¸€äº›ç±»çš„çŸ¥è¯†ï¼Œæœç´¢æµè§ˆäº†å‡ ç¯‡åˆçœ‹äº†çœ‹çœ¼å‰çš„ä»£ç è¿˜æ˜¯æ‡µåˆ°å¤´å¤§ã€‚æ­¤æ—¶è„‘ä¸­é—ªè¿‡åœ¨ GitHub é˜…è¿‡çš„ä¸€è¡Œä»£ç ï¼Œäºæ˜¯æ½‡æ´’æ‰å¤´ï¼Œä½•å¿…å›°äºå…·ä½“å®ç°å‘¢ï¼Œå…ˆæ¥è®¾è®¡å®ç°åçš„è°ƒç”¨æ¥å£å§ï¼äºæ˜¯å°†ç»„ä»¶å†…åŸä»£ç çš„æ–¹æ³•éƒ½åˆ äº†ä¸ªå¹²å‡€ï¼Œç•™ä¸‹äº†ï¼š

```js
methods: {
  submit() {
    this.wallet.checkout()
  }
},
created() {
  this.wallet = new Wallet(this.payType, this.payAddress, this.payAmount)
  this.wallet.init()
}
```

ä¹Ÿå°±æ˜¯è¯´åªéœ€è¦å°† `payType`ã€`payAddress`ã€`payAmount` è¾“å…¥ Walletï¼Œç„¶ååˆå§‹åŒ–å®ä¾‹ walletï¼Œå®ç°ç»„ä»¶å†…è°ƒç”¨å®ä¾‹çš„ç›¸åŒæ–¹æ³•ï¼Œå°±èƒ½å®Œæˆç›¸åŒçš„åŠŸèƒ½ï¼ˆè¾“å‡ºï¼‰ã€‚è¿™æ ·å°†ç»„ä»¶å†…çš„ methods æŠ½å‡ºç‹¬ç«‹çš„ utils ä»¥åï¼Œä»¥åæ–°å¢é’±åŒ…æ—¶è¿™ä¸ªç»„ä»¶æ˜¯æ— éœ€ä¿®æ”¹çš„ã€‚é‚£å…³é”®æ˜¯æ€ä¹ˆé€šè¿‡ç±»å»å®ç°æ ¹æ® `payType` çš„ä¸åŒå®ç°ç›¸åŒæ–¹æ³•çš„ä¸åŒå†…å®¹å‘¢ï¼Ÿæ³¨æ„è¿™ä¸ç›¸åŒæ–¹æ³•æ ¹æ® `payType` çš„ä¸åŒå®ç°ä¸åŒå†…å®¹çš„åŒºåˆ«ï¼Œåè€…éœ€è¦åœ¨å¤šä¸ª methods é‡Œé¢ä½¿ç”¨ `if`ï¼Œæ˜¯ä¸ç¬¦åˆè®¾è®¡ç†å¿µçš„ã€‚

å¯å°±åœ¨è¿™æ—¶ï¼Œè¢«è¯¢é—®è¿›åº¦æ€ä¹ˆæ ·ï¼Ÿäºæ˜¯ä¸€é˜µæŒ å¤´ï¼ŒæŒ‡å‘æˆ‘è®¾è®¡å¥½å´å°šä¸çŸ¥å¦‚ä½•å»å®ç°çš„ä»£ç ï¼Œç„¶åå¬ä»å»ºè®®å…ˆè®©åŸæ–¹æ³•å·¥ä½œï¼Œå°†æ•´ä¸ªæµç¨‹èµ°é€šã€‚çœ‹ç€åˆšè¢« Merged çš„ä»£ç ï¼Œè¿˜æ˜¯æœ‰äº›ä¸ç”˜ï¼Œäºæ˜¯å¾€ Todos é‡Œé¢é»˜é»˜åŠ äº†ä¸€é¡¹ã€‚

---

æ™šä¸Šå›æ¥åï¼Œç»§ç»­ä¸Šé¢çš„æ„æƒ³ï¼Œæƒ³ç€æ€ä¹ˆå»å®ç°ï¼Œæƒ³äº†æƒ³è¯•äº†è¯•è¿˜æ˜¯ä¸è¡Œã€‚äºæ˜¯å»è¯·æ•™å‰åŒäº‹å…³äºè¿™ç§é—®é¢˜çš„è®¾è®¡æ¨¡å¼ï¼Œå¾—åˆ°äº†å›ç­”â€”â€”å·¥å‚æ¨¡å¼ã€‚

æœç´¢é˜…è¯»ä¸€ç•ªåï¼Œæœ€ç»ˆæˆåŠŸå®ç°äº†ï¼å°½ç®¡ä¸æœ€å…ˆè®¾è®¡çš„æ¥å£æœ‰äº›ä¸åŒâ€¦â€¦é€šè¿‡å·¥å‚å‡½æ•°åˆ¤æ–­ `payType` åˆå§‹åŒ–ä¸åŒç±» A æˆ– B çš„å®ä¾‹ï¼ŒA å’Œ B æœ‰ç›¸åŒåå­—çš„ methodsï¼Œæ˜¯åŸç»„ä»¶è¦å®ç°åŠŸèƒ½çš„æŠ½è±¡æ‹†åˆ†ã€‚åæ¥å‘ç° A å’Œ B æœ‰ç›¸åŒå†…å®¹çš„ methodsï¼Œäºæ˜¯å†æ¬¡å°†å®ƒä»¬æŠ½æˆäº†ä¸€ä¸ª A å’Œ B çš„çˆ¶ç±» X[^1]ã€‚

```js
// components/unknown.vue
import { WalletFactory } from '../utils/wallet'

methods: {
  submit() {
    this.wallet.checkout()
  }
},
created() {
  this.wallet = WalletFactory.createWallet({
    payType: this.payType,
    payAddress: this.payAddress,
    payAmount: this.payAmount,
    scope: this
  })
  this.wallet.init()
}
```

```js
// utils/wallet/index.js
import { A } from './a'
import { B } from './b'

export const WalletFactory = {
  createWallet: (o) => {
    switch (o.payType) {
      // B
      case 'B':
        return new B(o)
      // Others
      default:
        return new A(o)
    }
  }
}
```

```js
// utils/wallet/a.js
import { Wallet } from '../wallet/wallet'

export class A extends Wallet {
  constructor(o) {
    super(o)
  }

  // ...

  checkout() {
    // do something
  }
}
```

```js
// utils/wallet/b.js
import { Wallet } from '../wallet/wallet'

export class B extends Wallet {
  constructor(o) {
    super(o)
  }

  // ...

  checkout() {
    // do something new
  }
}
```

```js
// utils/wallet/wallet.js
export class Wallet {
  constructor(o) {
    this.o = o
  }

  // ...

  init() {
    // do something via same named methods
  }
}
```

æœ€å `git add` && `git commit` && `git push`ï¼ŒGitHub æ PRï¼ŒMergedï¼ğŸ¥³

---

[^1]: A å’Œ B æ˜¯ä¸åŒç‹¬ç«‹æ–‡ä»¶ï¼Œæœ¬æ¥å°†çˆ¶ç±» X æ”¾åœ¨äº†å·¥å‚å‡½æ•°æ–‡ä»¶å†…ï¼Œåæ¥å‘ç°æŠ¥é”™ï¼Œæœç´¢å‘ç°åº”è¯¥æ˜¯æ¨¡å—çš„å¾ªç¯åŠ è½½å¯¼è‡´çš„é—®é¢˜ï¼Œäºæ˜¯æŠŠ X ä¹Ÿå†™æˆäº†ç‹¬ç«‹æ–‡ä»¶ã€‚æ•´ä¸ªé‡æ„è¿‡ç¨‹ä¸­è‡ªç„¶å°†æ•´ä¸ªåŸç»„ä»¶çš„å†…å¤–é€»è¾‘éƒ½åƒé€äº†ã€‚
